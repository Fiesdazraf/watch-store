{% extends "backoffice/base.html" %}
{% load humanize %}
{% block title %}Ù„ÛŒØ³Øª ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ | Watch-Store{% endblock %}

{% block content %}
<section class="section pt-5">
  <div class="container">

    <h1 class="title is-4 mb-5">ğŸ§¾ Ù„ÛŒØ³Øª ÙØ§Ú©ØªÙˆØ±Ù‡Ø§</h1>

    <!-- ğŸ”¹ ÙÛŒÙ„ØªØ±Ù‡Ø§ -->
    <form method="get" class="box mb-5">
      <div class="columns is-multiline">
        <div class="column is-one-quarter">
          <label class="label">Ø§Ø² ØªØ§Ø±ÛŒØ®</label>
          <input class="input" type="date" name="start" value="{{ filters.start|default_if_none:'' }}">
        </div>
        <div class="column is-one-quarter">
          <label class="label">ØªØ§ ØªØ§Ø±ÛŒØ®</label>
          <input class="input" type="date" name="end" value="{{ filters.end|default_if_none:'' }}">
        </div>
        <div class="column is-one-quarter">
          <label class="label">ÙˆØ¶Ø¹ÛŒØª</label>
          <div class="select is-fullwidth">
            <select name="status">
              <option value="">Ù‡Ù…Ù‡</option>
              <option value="pending" {% if filters.status == 'pending' %}selected{% endif %}>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
              <option value="paid" {% if filters.status == 'paid' %}selected{% endif %}>Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒØ´Ø¯Ù‡</option>
              <option value="canceled" {% if filters.status == 'canceled' %}selected{% endif %}>Ù„ØºÙˆØ´Ø¯Ù‡</option>
            </select>
          </div>
        </div>
        <div class="column is-one-quarter is-flex is-align-items-flex-end" style="gap:.5rem">
          <button class="button is-primary" type="submit">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±</button>
          <a href="{% url 'backoffice:invoices_list' %}" class="button">Ø±ÛŒØ³Øª</a>
        </div>
      </div>
    </form>

    <!-- ğŸ”¹ Ø¬Ø¯ÙˆÙ„ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ -->
    <div class="box">
      <div class="table-container">
        <table class="table is-fullwidth is-striped is-hoverable">
          <thead>
            <tr>
              <th>Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ±</th>
              <th class="has-text-centered">Ù…Ø¨Ù„Øº</th>
              <th class="has-text-centered">ÙˆØ¶Ø¹ÛŒØª</th>
              <th class="has-text-centered">ØªØ§Ø±ÛŒØ® ØµØ¯ÙˆØ±</th>
              <th class="has-text-centered">ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª</th>
              <th class="has-text-centered">Ø³ÙØ§Ø±Ø´</th>
            </tr>
          </thead>
          <tbody>
            {% for inv in invoices %}
              <tr>
                <td>
                  <a href="{% url 'invoices:invoice_detail' inv.number %}" class="has-text-link">
                    #{{ inv.number }}
                  </a>
                </td>
                <td class="has-text-centered has-text-weight-semibold">
                  {{ inv.amount|floatformat:0|intcomma }} ØªÙˆÙ…Ø§Ù†
                </td>
                <td class="has-text-centered">
                  {% include "backoffice/partials/_order_status_badge.html" with status=inv.status %}
                </td>
                <td class="has-text-centered">
                  {{ inv.issued_at|date:"Y-m-d H:i" }}
                </td>
                <td class="has-text-centered">
                  {{ inv.paid_at|default:"â€”"|date:"Y-m-d H:i" }}
                </td>
                <td class="has-text-centered">
                  {% if inv.order %}
                    <a href="{% url 'orders:detail' inv.order.number %}" class="button is-small is-link is-light">
                      <span class="icon"><i class="fas fa-box"></i></span>
                      <span>Ø³ÙØ§Ø±Ø´ {{ inv.order.number }}</span>
                    </a>
                  {% else %}
                    <span class="has-text-grey">â€”</span>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="6" class="has-text-centered">Ù‡ÛŒÚ† ÙØ§Ú©ØªÙˆØ±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if invoices.has_other_pages %}
      <nav class="pagination is-centered mt-5" role="navigation" aria-label="pagination">
        {% if invoices.has_previous %}
          <a class="pagination-previous" href="?page={{ invoices.previous_page_number }}">Ù‚Ø¨Ù„ÛŒ</a>
        {% else %}
          <span class="pagination-previous is-disabled">Ù‚Ø¨Ù„ÛŒ</span>
        {% endif %}
        {% if invoices.has_next %}
          <a class="pagination-next" href="?page={{ invoices.next_page_number }}">Ø¨Ø¹Ø¯ÛŒ</a>
        {% else %}
          <span class="pagination-next is-disabled">Ø¨Ø¹Ø¯ÛŒ</span>
        {% endif %}
        <ul class="pagination-list">
          {% for i in invoices.paginator.page_range %}
            {% if i == invoices.number %}
              <li><a class="pagination-link is-current">{{ i }}</a></li>
            {% else %}
              <li><a class="pagination-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>
      </nav>
      {% endif %}
    </div>

  </div>
</section>
{% endblock %}
