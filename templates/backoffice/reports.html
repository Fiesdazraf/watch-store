{% extends "backoffice/base.html" %}
{% load humanize %}

{% block title %}ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ | Watch-Store{% endblock %}

{% block content %}
<section class="section pt-5">
  <div class="container">

    <h1 class="title is-4 mb-5">ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ ÙØ±ÙˆØ´ Ùˆ Ø¹Ù…Ù„Ú©Ø±Ø¯</h1>

    <!-- ğŸ”¹ ÙÛŒÙ„ØªØ±Ù‡Ø§ -->
    <form method="get" class="box mb-5">
      <div class="columns is-multiline">
        <div class="column is-one-quarter">
          <label class="label">Ø§Ø² ØªØ§Ø±ÛŒØ®</label>
          <input class="input" type="date" name="start" value="{{ start|date:'Y-m-d' }}">
        </div>
        <div class="column is-one-quarter">
          <label class="label">ØªØ§ ØªØ§Ø±ÛŒØ®</label>
          <input class="input" type="date" name="end" value="{{ end|date:'Y-m-d' }}">
        </div>
        <div class="column is-one-quarter is-flex is-align-items-flex-end" style="gap:.5rem">
          <button class="button is-primary" type="submit">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±</button>
          <a href="{% url 'backoffice:reports' %}" class="button">Ø±ÛŒØ³Øª</a>
        </div>
      </div>

      <p class="help mt-2">
        ğŸ’° Ù…Ø¬Ù…ÙˆØ¹ ÙØ±ÙˆØ´ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡:
        <strong>{{ total_sum|floatformat:0|intcomma }}</strong> ØªÙˆÙ…Ø§Ù†
      </p>

      <!-- ğŸ”¹ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ -->
      <div class="buttons mt-4">
        <a class="button is-link"
           href="{% url 'backoffice:export_sales_csv' %}?{{ request.GET.urlencode }}">
          <span class="icon"><i class="fas fa-file-csv"></i></span><span>Export CSV</span>
        </a>
        <a class="button is-info"
           href="{% url 'backoffice:export_sales_xlsx' %}?{{ request.GET.urlencode }}">
          <span class="icon"><i class="fas fa-file-excel"></i></span><span>Export Excel</span>
        </a>
        <a class="button is-primary"
           href="{% url 'backoffice:export_sales_pdf' %}?{{ request.GET.urlencode }}">
          <span class="icon"><i class="fas fa-file-pdf"></i></span><span>Export PDF</span>
        </a>
      </div>
    </form>

    <!-- ğŸ”¹ Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ±ÙˆØ´ -->
    <div class="box mb-5">
      <h2 class="title is-5 mb-3">Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ±ÙˆØ´ Ø±ÙˆØ²Ø§Ù†Ù‡ Ø¯Ø± Ø¨Ø§Ø²Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ</h2>
      <div class="chart-wrap"><canvas id="salesReportChart"></canvas></div>
    </div>

    <!-- ğŸ”¹ Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ -->
    <div class="box table-container">
      <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
          <tr>
            <th>ØªØ§Ø±ÛŒØ®</th>
            <th class="has-text-centered">Ù…Ø¨Ù„Øº ÙØ±ÙˆØ´ (ØªÙˆÙ…Ø§Ù†)</th>
          </tr>
        </thead>
        <tbody>
          {% for p in series %}
            <tr>
              <td>{{ p.label }}</td>
              <td class="has-text-centered">{{ p.value|floatformat:0|intcomma }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="2" class="has-text-centered">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¨Ø§Ø²Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</section>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const chartData = {
    labels: [{% for p in series %}"{{ p.label }}"{% if not forloop.last %}, {% endif %}{% endfor %}],
    datasets: [{
      label: "Ù…ÛŒØ²Ø§Ù† ÙØ±ÙˆØ´ (ØªÙˆÙ…Ø§Ù†)",
      data: [{% for p in series %}{{ p.value }}{% if not forloop.last %}, {% endif %}{% endfor %}],
      fill: true,
      tension: 0.35,
      borderColor: "#c9a227",
      backgroundColor: "rgba(201,162,39,0.25)",
      pointRadius: 4,
      pointHoverRadius: 6
    }]
  };

  const ctx = document.getElementById("salesReportChart");
  if (ctx) {
    new Chart(ctx, {
      type: "line",
      data: chartData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: "bottom", labels: { color: "#e9edf5" } },
          tooltip: { mode: "index", intersect: false }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: { color: "#9aa3b2" },
            grid: { color: "rgba(255,255,255,0.08)" }
          },
          x: {
            ticks: { color: "#9aa3b2" },
            grid: { color: "rgba(255,255,255,0.05)" }
          }
        }
      }
    });
  }
</script>

<style>
  .chart-wrap { position: relative; min-height: 340px; }
  @media (max-width: 768px) { .chart-wrap { height: 280px; } }
</style>
{% endblock %}
