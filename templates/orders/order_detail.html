{% extends "base.html" %}
{% load humanize %}
{% block title %}Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´ {{ order.number }}{% endblock %}

{% block content %}
<section class="section pt-5">
  <div class="container">

    <!-- Title -->
    <h1 class="title is-4 mb-4">ğŸ§¾ Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§Ø±Ù‡ {{ order.number }}</h1>

    <!-- âœ… Order Meta -->
    <div class="box mb-5">
      <div class="columns is-multiline is-variable is-3">
        <div class="column is-half">
          <p><strong>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª:</strong> {{ order.placed_at|date:"Y-m-d H:i" }}</p>
        </div>
        <div class="column is-half">
          <p>
            <strong>ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´:</strong>
            {% if order.is_paid %}
              <span class="tag is-success is-light">Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒØ´Ø¯Ù‡</span>
            {% else %}
              <span class="tag is-warning is-light">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª</span>
            {% endif %}
          </p>
        </div>
        <div class="column is-half">
          <p><strong>Ù…Ø¨Ù„Øº Ú©Ù„:</strong> {{ order.grand_total|intcomma }} ØªÙˆÙ…Ø§Ù†</p>
        </div>
        <div class="column is-half">
          <p><strong>Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„:</strong> {{ order.shipping_method.name|default:"-" }}</p>
        </div>
      </div>
    </div>

    <!-- âœ… Payment Info -->
    <div class="box mb-5">
      <h2 class="title is-5 mb-4">ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª</h2>

      {% with p=order.payments.first %}
        {% if p %}
          <p><strong>Ø¯Ø±Ú¯Ø§Ù‡ / Ø±ÙˆØ´:</strong> {{ p.provider|default:"-" }}</p>
          <p>
            <strong>ÙˆØ¶Ø¹ÛŒØª ØªØ±Ø§Ú©Ù†Ø´:</strong>
            {% if p.status == "succeeded" %}
              <span class="tag is-success is-light">Ù…ÙˆÙÙ‚</span>
            {% elif p.status == "failed" %}
              <span class="tag is-danger is-light">Ù†Ø§Ù…ÙˆÙÙ‚</span>
            {% elif p.status == "processing" %}
              <span class="tag is-info is-light">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´</span>
            {% elif p.status == "canceled" %}
              <span class="tag is-light">Ù„ØºÙˆ Ø´Ø¯Ù‡</span>
            {% else %}
              <span class="tag is-warning is-light">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
            {% endif %}
          </p>
          {% if p.external_id %}
            <p><strong>Ú©Ø¯ ØªØ±Ø§Ú©Ù†Ø´:</strong> <code>{{ p.external_id }}</code></p>
          {% endif %}
          {% if p.paid_at %}
            <p><strong>ØªØ§Ø±ÛŒØ® Ù¾Ø±Ø¯Ø§Ø®Øª:</strong> {{ p.paid_at|date:"Y-m-d H:i" }}</p>
          {% endif %}
        {% else %}
          <p class="has-text-grey">Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø³ÙØ§Ø±Ø´ Ù‡Ù†ÙˆØ² Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
        {% endif %}
      {% endwith %}

      <div class="mt-4">
        {% if not order.is_paid %}
          {% if order.get_checkout_payment_url %}
            <a href="{{ order.get_checkout_payment_url }}" class="button is-primary is-medium">
              <span class="icon"><i class="fas fa-credit-card"></i></span>
              <span>Ù¾Ø±Ø¯Ø§Ø®Øª / ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</span>
            </a>
          {% else %}
            <a href="{% url 'payments:checkout' order_number=order.number %}" class="button is-primary is-medium">
              <span class="icon"><i class="fas fa-credit-card"></i></span>
              <span>Ù¾Ø±Ø¯Ø§Ø®Øª / ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</span>
            </a>
          {% endif %}
        {% else %}
          <a href="{% url 'orders:order_list' %}" class="button is-light">
            <span class="icon"><i class="fas fa-arrow-right"></i></span>
            <span>Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</span>
          </a>
        {% endif %}
      </div>
    </div>

    <!-- âœ… Order Items -->
    <div class="box mb-6">
      <h2 class="title is-5 mb-4">Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø³ÙØ§Ø±Ø´</h2>

      <div class="table-container">
        <table class="table is-fullwidth is-striped is-hoverable">
          <thead>
            <tr>
              <th>Ù…Ø­ØµÙˆÙ„</th>
              <th>ØªÙ†ÙˆØ¹</th>
              <th class="has-text-centered">ØªØ¹Ø¯Ø§Ø¯</th>
              <th class="has-text-centered">Ù‚ÛŒÙ…Øª ÙˆØ§Ø­Ø¯</th>
              <th class="has-text-centered">Ø¬Ù…Ø¹ Ø¬Ø²Ø¡</th>
            </tr>
          </thead>
          <tbody>
            {% for item in order.items.all %}
            <tr>
              <td>{{ item.product.title }}</td>
              <td>{{ item.variant|default:"-" }}</td>
              <td class="has-text-centered">{{ item.qty }}</td>
              <td class="has-text-centered">{{ item.unit_price|intcomma }} ØªÙˆÙ…Ø§Ù†</td>
              <td class="has-text-centered has-text-weight-semibold">{{ item.get_total|intcomma }} ØªÙˆÙ…Ø§Ù†</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="is-flex is-justify-content-flex-end mt-4">
        <div class="content has-text-right">
          <p><strong>Ø¬Ù…Ø¹ Ø¬Ø²Ø¡:</strong> {{ order.subtotal|intcomma }} ØªÙˆÙ…Ø§Ù†</p>
          <p><strong>Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„:</strong> {{ order.shipping_cost|intcomma }} ØªÙˆÙ…Ø§Ù†</p>
          {% if order.discount_total %}
            <p><strong>ØªØ®ÙÛŒÙ:</strong> -{{ order.discount_total|intcomma }} ØªÙˆÙ…Ø§Ù†</p>
          {% endif %}
          <p class="is-size-5 mt-3"><strong>Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</strong>
            <span class="has-text-primary has-text-weight-bold">
              {{ order.total_payable|intcomma }} ØªÙˆÙ…Ø§Ù†
            </span>
          </p>
        </div>
      </div>
    </div>

  </div>
</section>
{% endblock %}
