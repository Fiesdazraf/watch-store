{% extends "base.html" %}
{% block title %}تاریخچه پرداخت‌ها{% endblock %}

{% block content %}
<section class="section pt-5">
  <div class="container">
    <h1 class="title is-4">تاریخچه پرداخت‌ها</h1>

    {% if payments %}
      <div class="table-container">
        <table class="table is-fullwidth is-striped is-hoverable is-narrow">
          <thead>
            <tr>
              <th>سفارش</th>
              <th>مبلغ</th>
              <th>واحد</th>
              <th>روش</th>
              <th>وضعیت</th>
              <th>تاریخ</th>
              <th>شناسه تراکنش</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
          {% for p in payments %}
            <tr>
              <td><a href="{% url 'orders:detail' p.order.number %}">
                {{ p.order.number }}
              </a></td>
              <td>{{ p.amount }}</td>
              <td>{{ p.currency }}</td>
              <td>{{ p.get_method_display }}</td>
              <td>
                <span class="tag is-light
                  {% if p.status == 'success' %}is-success
                  {% elif p.status == 'failed' %}is-danger
                  {% elif p.status == 'canceled' %}is-warning
                  {% else %}is-info{% endif %}">
                  {{ p.get_status_display }}
                </span>
              </td>
              <td>{{ p.created_at|date:"Y-m-d H:i" }}</td>
              <td>{{ p.transaction_id|default:"-" }}</td>
              <td class="has-text-right">
                <a class="button is-small" href="{% url 'orders:detail' p.order.number %}">جزئیات سفارش</a>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

      {% if payments.has_other_pages %}
      <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        {% if payments.has_previous %}
          <a class="pagination-previous" href="?page={{ payments.previous_page_number }}">قبلی</a>
        {% endif %}
        {% if payments.has_next %}
          <a class="pagination-next" href="?page={{ payments.next_page_number }}">بعدی</a>
        {% endif %}
        <ul class="pagination-list">
          {% for i in payments.paginator.page_range %}
            {% if i == payments.number %}
              <li><a class="pagination-link is-current">{{ i }}</a></li>
            {% else %}
              <li><a class="pagination-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>
      </nav>
      {% endif %}
    {% else %}
      <div class="notification is-info">پرداختی ثبت نشده است.</div>
    {% endif %}

    <div class="buttons mt-4">
      <a class="button is-light" href="{% url 'orders:history' %}">سفارش‌های من</a>
      <a class="button is-link is-light" href="{% url 'catalog:product_list' %}">ادامه خرید</a>
    </div>
  </div>
</section>
{% endblock %}
