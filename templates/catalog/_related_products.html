{% load static humanize %}

{% if related_products %}
<section class="section pt-4">
  <h3 class="title is-5 mb-4 has-text-centered">محصولات مرتبط</h3>

  <div class="columns is-multiline">
    {% for rp in related_products %}
      <div class="column is-6-tablet is-3-desktop">
        <article class="card related-card has-text-centered">
          <div class="card-image p-3">
            <a href="{% url 'catalog:product_detail' pk=rp.id slug=rp.slug %}" aria-label="{{ rp.title }}">
              <figure class="image is-4by3">
                {% if rp.primary_image %}
                  <img src="{{ rp.primary_image.url }}" alt="{{ rp.title }}" loading="lazy"
                       onerror="this.onerror=null;this.src='{% static 'shop/placeholder-300x225.png' %}';">
                {% else %}
                  <img src="{% static 'shop/placeholder-300x225.png' %}" alt="{{ rp.title }}" loading="lazy">
                {% endif %}
              </figure>
            </a>
          </div>

          <div class="card-content">
            <p class="is-size-6 has-text-weight-semibold mb-1">
              <a href="{% url 'catalog:product_detail' pk=rp.id slug=rp.slug %}">
                {{ rp.title }}
              </a>
            </p>

            {% if rp.brand %}
              <p class="is-size-7 has-text-grey mb-2">{{ rp.brand.name }}</p>
            {% endif %}

            <p class="has-text-weight-bold has-text-primary mb-2">
              {{ rp.price|intcomma }} تومان
            </p>

            <a href="{% url 'catalog:product_detail' pk=rp.id slug=rp.slug %}"
               class="button is-small is-link is-light">مشاهده</a>
          </div>
        </article>
      </div>
    {% endfor %}
  </div>
</section>
{% endif %}
