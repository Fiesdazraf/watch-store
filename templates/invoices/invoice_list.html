{% extends "backoffice/base.html" %}
{% load humanize %}
{% block title %}فاکتورها{% endblock %}
{% block content %}
<section class="section pt-5">
  <div class="container">
    <h1 class="title is-4 mb-5">فاکتورها</h1>

    <form method="get" class="box mb-4">
      <div class="columns is-multiline">
        <div class="column is-3">
          <label class="label">جستجو</label>
          <input class="input" type="text" name="q" value="{{ query }}" placeholder="شماره فاکتور / شماره سفارش">
        </div>
        <div class="column is-2">
          <label class="label">وضعیت</label>
          <div class="select is-fullwidth">
            <select name="status">
              <option value="">همه</option>
              <option value="paid" {% if status == 'paid' %}selected{% endif %}>پرداخت‌شده</option>
              <option value="unpaid" {% if status == 'unpaid' %}selected{% endif %}>پرداخت‌نشده</option>
              <option value="void" {% if status == 'void' %}selected{% endif %}>باطل</option>
            </select>
          </div>
        </div>
        <div class="column is-2">
          <label class="label">از تاریخ</label>
          <input class="input" type="date" name="start" value="{{ start }}">
        </div>
        <div class="column is-2">
          <label class="label">تا تاریخ</label>
          <input class="input" type="date" name="end" value="{{ end }}">
        </div>
        <div class="column is-3 is-flex is-align-items-flex-end" style="gap:.5rem">
          <button class="button is-primary">اعمال فیلتر</button>
          <a class="button" href="{% url 'backoffice:invoices_list' %}">ریست</a>
        </div>
      </div>
    </form>

    <div class="box">
      <div class="table-container">
        <table class="table is-fullwidth is-striped is-hoverable">
          <thead>
            <tr>
              <th>شماره</th>
              <th>سفارش</th>
              <th>مبلغ</th>
              <th>وضعیت</th>
              <th>صدور</th>
              <th>پرداخت</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for inv in invoices %}
              <tr>
                <td>{{ inv.number }}</td>
                <td>{% if inv.order %}{{ inv.order.number }}{% else %}—{% endif %}</td>
                <td>{{ inv.amount|floatformat:0|intcomma }} تومان</td>
                <td><span class="tag">{{ inv.get_status_display }}</span></td>
                <td>{{ inv.issued_at|date:"Y-m-d H:i" }}</td>
                <td>{{ inv.paid_at|date:"Y-m-d H:i" }}</td>
                <td class="has-text-right">
                  <a class="button is-small" href="{% url 'invoices:invoice_detail' inv.number %}">جزئیات</a>
                  <a class="button is-small is-light" href="{% url 'invoices:invoice_pdf' inv.number %}">PDF</a>
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="7" class="has-text-centered">موردی یافت نشد.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</section>
{% endblock %}
